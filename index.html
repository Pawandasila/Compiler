<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Custom Language Compiler</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 1000px;
        margin: 0 auto;
        padding: 20px;
        background-color: #f5f5f5;
      }
      .language-info {
        background-color: #e7f3fe;
        border-left: 6px solid #2196f3;
        margin-bottom: 20px;
        padding: 10px;
      }
      h1 {
        color: #333;
        text-align: center;
      }
      .container {
        display: flex;
        flex-direction: column;
        gap: 20px;
      }
      .editor-container {
        display: flex;
        gap: 20px;
        height: 500px;
      }
      .panel {
        flex: 1;
        display: flex;
        flex-direction: column;
        background: white;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        padding: 15px;
      }
      .panel h2 {
        margin-top: 0;
        margin-bottom: 10px;
        color: #444;
      }
      textarea {
        flex: 1;
        resize: none;
        padding: 10px;
        font-family: monospace;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 14px;
      }
      .controls {
        display: flex;
        justify-content: flex-end;
        margin-top: 10px;
      }
      .compile-btn {
        background-color: #4caf50;
        color: white;
        border: none;
        padding: 10px 20px;
        text-align: center;
        text-decoration: none;
        display: inline-block;
        font-size: 16px;
        border-radius: 4px;
        cursor: pointer;
        transition: background-color 0.3s;
      }
      .compile-btn:hover {
        background-color: #45a049;
      }
      .output-container {
        display: flex;
        flex-direction: column;
        gap: 20px;
      }
      .result,
      .bytecode,
      .error {
        padding: 15px;
        background: white;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }
      .error {
        color: #d8000c;
        background-color: #ffd2d2;
        display: none;
      }
      pre {
        margin: 0;
        white-space: pre-wrap;
        font-family: monospace;
        font-size: 14px;
      }
    </style>
  </head>
  <body>
    <h1>Custom Language Compiler</h1>

    <div class="language-info">
      <h3>Language Syntax Guide</h3>
      <p>This compiler uses a custom language with the following features:</p>
      <ul>
        <li>
          <strong>Variable declarations:</strong> Use <code>int</code> or
          <code>float</code> types (e.g., <code>int x = 5;</code>)
        </li>
        <li>
          <strong>Arithmetic operations:</strong> +, -, *, / (e.g.,
          <code>x + y</code>)
        </li>
        <li>
          <strong>Variable assignments:</strong>
          <code>int result = x + y;</code>
        </li>
        <li>
          <strong>Output:</strong> The last expression's value will be returned
          as the result
        </li>
        <li><strong>Semicolons:</strong> Required after each statement</li>
        <li>
          <strong>Comments:</strong> Use <code>//</code> for single-line
          comments
        </li>
      </ul>
      <p>Examples of valid code:</p>
      <pre>
int x = 10;
int result = x * 2;
result;</pre
      >
      <p>
        Note: This compiler does not support C++, Java, Python, or other common
        programming languages.
      </p>
    </div>

    <div class="container">
      <div class="editor-container">
        <div class="panel">
          <h2>Source Code</h2>
          <textarea id="source-code" placeholder="Enter your code here...">
    // This is the custom language syntax
    // For simple calculations

    // Variable declarations
    int x = 5;
    int y = 10;

    // Store the result in another variable
    int result = x + y;

    // The last expression's value will be shown in the output
    result;
    </textarea
          >
          <div class="controls">
            <button id="compile-btn" class="compile-btn">Compile & Run</button>
          </div>
        </div>
      </div>

      <div class="output-container">
        <div class="result">
          <h2>Result</h2>
          <pre id="result-output">
Output will appear here after compilation.</pre
          >
        </div>

        <div class="bytecode">
          <h2>Generated Bytecode</h2>
          <pre id="bytecode-output">
Bytecode will appear here after compilation.</pre
          >
        </div>

        <div class="error" id="error-container">
          <h2>Error</h2>
          <pre id="error-output"></pre>
        </div>
      </div>
    </div>
    <script>
      document
        .getElementById("compile-btn")
        .addEventListener("click", async () => {
          const sourceCode = document.getElementById("source-code").value;
          const language = "custom"; // Hardcoded to use a single language
          const resultOutput = document.getElementById("result-output");
          const bytecodeOutput = document.getElementById("bytecode-output");
          const errorContainer = document.getElementById("error-container");
          const errorOutput = document.getElementById("error-output");

          // Reset outputs
          resultOutput.textContent = "Compiling...";
          bytecodeOutput.textContent = "Compiling...";
          errorContainer.style.display = "none";

          try {
            const response = await fetch("http://127.0.0.1:8080/compile", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({
                source: sourceCode,
                language: language,
              }),
            });

            const data = await response.json();

            if (data.error) {
              errorContainer.style.display = "block";
              errorOutput.textContent = data.error;
              resultOutput.textContent = "Execution failed. See error above.";
              bytecodeOutput.textContent =
                "No bytecode generated due to error.";
            } else {
              resultOutput.textContent = data.result || "No output";
              bytecodeOutput.textContent =
                data.bytecode.join("\n") || "No bytecode generated";
            }
          } catch (error) {
            errorContainer.style.display = "block";
            errorOutput.textContent = `Failed to connect to compiler server: ${error.message}`;
            resultOutput.textContent =
              "Connection error. Is the server running?";
            bytecodeOutput.textContent = "No bytecode available.";
          }
        });
    </script>
  </body>
</html>
